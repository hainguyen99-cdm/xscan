"use strict";(()=>{var e={};e.id=492,e.ids=[492],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},68687:(e,t,o)=>{o.r(t),o.d(t,{headerHooks:()=>f,originalPathname:()=>m,patchFetch:()=>C,requestAsyncStorage:()=>h,routeModule:()=>g,serverHooks:()=>y,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>v});var n={};o.r(n),o.d(n,{DELETE:()=>D,PUT:()=>d,runtime:()=>i});var r=o(6170),s=o(8533),a=o(54387),l=o(40064);let i="nodejs",u=(()=>{process.env.NEXT_PUBLIC_BACKEND_URL;let e="http://xscan-backend:3001";return e.includes("localhost:3000")&&(e=e.replace("localhost:3000","localhost:3001")),e})();async function c(e){try{if((e.headers.get("content-type")||"").includes("multipart/form-data")){let t=await e.formData(),o={};for(let[e,n]of Array.from(t.entries()))if(n instanceof File)try{let t=await n.arrayBuffer(),r=Buffer.from(t).toString("base64");o[e]={name:n.name,type:n.type,size:n.size,data:`data:${n.type};base64,${r}`},console.log(`📁 Processed file: ${n.name}, size: ${n.size} bytes, encoded: ${r.length} chars`)}catch(e){throw console.error(`❌ Error processing file ${n.name}:`,e),Error(`Failed to process file: ${n.name}`)}else o[e]=n;return o}{let t=await e.text();if(!t)return{};if(console.log(`📝 Raw request body size: ${t.length} characters`),t.length>52428800)throw Error("Request payload exceeds 50MB limit");try{return JSON.parse(t)}catch(e){throw console.error("Failed to parse JSON body:",e),Error("Invalid JSON payload")}}}catch(e){throw console.error("Error parsing request body:",e),e}}async function d(e,{params:t}){try{let o=decodeURIComponent(t.levelId);if(console.log("\uD83D\uDE80 PUT request received for donation level:",o),console.log("\uD83D\uDD0D Original encoded levelId:",t.levelId),!o||"string"!=typeof o)return console.error("❌ Invalid levelId:",o),l.Z.json({error:"Invalid level ID format",code:"INVALID_LEVEL_ID"},{status:400});let n=e.headers.get("authorization");if(!n)return l.Z.json({error:"Authorization header required"},{status:401});let r=e.headers.get("content-length"),s=e.headers.get("content-type");console.log("\uD83D\uDCDD Request content-length header:",r),console.log("\uD83D\uDCDD Request content-type:",s),console.log("\uD83D\uDCDD Request method:",e.method),console.log("\uD83D\uDCDD Request URL:",e.url),console.log("\uD83D\uDD04 Starting to parse request body...");let a=await c(e);console.log("\uD83D\uDCDD Parsed request body size:",JSON.stringify(a).length,"characters"),console.log("\uD83D\uDCDD Body keys:",Object.keys(a)),console.log("\uD83D\uDCDD Body levelId:",a.levelId),console.log("\uD83D\uDCDD URL levelId:",o),console.log("\uD83D\uDCDD LevelId match:",a.levelId===o),JSON.stringify(a).length>52428800&&console.warn("⚠️ Body size exceeds 50MB, may cause backend issues"),console.log("\uD83C\uDF10 Backend URL:",u);let i=e.headers.get("cookie")||"";try{let e=await fetch(`${u}/api/health`,{method:"GET",headers:{"Content-Type":"application/json"}});console.log("\uD83C\uDFE5 Backend health check status:",e.status)}catch(e){return console.error("❌ Backend connectivity test failed:",e),l.Z.json({error:"Backend service is not available. Please ensure the backend server is running.",code:"BACKEND_UNAVAILABLE"},{status:503})}let d=new AbortController,D=setTimeout(()=>d.abort(),3e5);console.log("\uD83C\uDF10 Making request to:",`${u}/api/obs-settings/donation-levels/${encodeURIComponent(o)}`),console.log("\uD83D\uDCDD Request body size:",JSON.stringify(a).length),console.log("\uD83D\uDCDD Request headers:",{"Content-Type":"application/json","Content-Length":JSON.stringify(a).length.toString(),Authorization:n?"Bearer [REDACTED]":"None",Cookie:i?"Present":"None"});let g=await fetch(`${u}/api/obs-settings/donation-levels/${encodeURIComponent(o)}`,{method:"PUT",headers:{"Content-Type":"application/json","Content-Length":JSON.stringify(a).length.toString(),cookie:i,authorization:n},body:JSON.stringify(a),signal:d.signal});clearTimeout(D);let h=await g.text(),p=g.headers.get("Content-Type")||"application/json";if(console.log("\uD83D\uDCE1 Backend response status:",g.status),console.log("\uD83D\uDCE1 Backend response text length:",h.length),!g.ok)return console.error("❌ Backend request failed:",g.status,h),new l.Z(h,{status:g.status,headers:{"Content-Type":p}});return console.log("✅ Backend update successful"),new l.Z(h,{status:g.status,headers:{"Content-Type":p}})}catch(t){if(console.error("Error updating donation level:",t),t instanceof Error&&t.message.includes("Failed to parse request body"))return l.Z.json({error:"Request payload is too large or invalid. Please ensure files are under 50MB.",code:"PAYLOAD_TOO_LARGE"},{status:413});if(t instanceof Error&&("AbortError"===t.name||t.message.includes("timeout")))return l.Z.json({error:"Request timed out. The file may be too large or the server is busy. Please try again.",code:"REQUEST_TIMEOUT"},{status:408});if(t instanceof Error&&t.message.includes("fetch"))return l.Z.json({error:"Network error. Please check your connection and try again.",code:"NETWORK_ERROR"},{status:503});let e=t instanceof Error?t.message:"Unknown error";return l.Z.json({success:!1,message:e},{status:500})}}async function D(e,{params:t}){try{let o=decodeURIComponent(t.levelId),n=e.headers.get("authorization");if(!n)return l.Z.json({error:"Authorization header required"},{status:401});let r=e.headers.get("cookie")||"",s=await fetch(`${u}/api/obs-settings/donation-levels/${encodeURIComponent(o)}`,{method:"DELETE",headers:{authorization:n,cookie:r}}),a=await s.text(),i=s.headers.get("Content-Type")||"application/json";return s.ok,new l.Z(a,{status:s.status,headers:{"Content-Type":i}})}catch(t){let e=t instanceof Error?t.message:"Unknown error";return l.Z.json({success:!1,message:e},{status:500})}}let g=new r.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/obs-settings/donation-levels/[levelId]/route",pathname:"/api/obs-settings/donation-levels/[levelId]",filename:"route",bundlePath:"app/api/obs-settings/donation-levels/[levelId]/route"},resolvedPagePath:"D:\\repo\\xscan\\frontend\\src\\app\\api\\obs-settings\\donation-levels\\[levelId]\\route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:h,staticGenerationAsyncStorage:p,serverHooks:y,headerHooks:f,staticGenerationBailout:v}=g,m="/api/obs-settings/donation-levels/[levelId]/route";function C(){return(0,a.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:p})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),n=t.X(0,[3499,7386],()=>o(68687));module.exports=n})();