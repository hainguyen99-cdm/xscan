(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8372],{67852:function(e,t,i){Promise.resolve().then(i.bind(i,70413))},70413:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return d}});var n=i(37821),s=i(58078),a=i(46179),r=i(39788),o=i(61414),l=i(30189);function d(){let e=(0,a.useRouter)(),{addDonationLink:t,user:i,isAuthenticated:d}=(0,o.qr)(),{isAuthenticating:c}=(0,o.tN)(),[u,h]=(0,s.useState)(!1),[m,g]=(0,s.useState)(null);(0,s.useEffect)(()=>{console.log("\uD83D\uDD0D Auth state check:",{isAuthenticating:c,isAuthenticated:d,userRole:null==i?void 0:i.role,user:i,token:(0,l.hV)()}),c||d&&(null==i?void 0:i.role)==="streamer"?console.log("✅ Access granted to donation links create page"):(console.log("❌ Access denied, redirecting to login"),console.log("❌ Reason:",{isAuthenticating:c,isAuthenticated:d,userRole:null==i?void 0:i.role,hasUser:!!i}),e.push("/login?redirect=/donation-links/create"))},[c,d,null==i?void 0:i.role,e]);let x=async i=>{h(!0),g(null);try{let n=(0,l.hV)();if(!n)throw Error("Authentication required");let s=await fetch("/api/donation-links",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)},body:JSON.stringify(i)});if(!s.ok){let e=await s.json();throw Error(e.message||"Failed to create donation link")}let a=await s.json();t(a.data),e.push("/dashboard/donation-links")}catch(e){g(e instanceof Error?e.message:"An unexpected error occurred")}finally{h(!1)}};return c?(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Loading..."})]})}):d&&(null==i?void 0:i.role)==="streamer"?(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,n.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,n.jsx)("div",{className:"mb-8",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Create Donation Link"}),(0,n.jsx)("p",{className:"mt-2 text-gray-600",children:"Set up a new donation page for your stream and start receiving support from your audience."})]}),(0,n.jsxs)("button",{onClick:()=>e.back(),className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[(0,n.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Back"]})]})}),m&&(0,n.jsx)("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-md p-4",children:(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,n.jsxs)("div",{className:"ml-3",children:[(0,n.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),(0,n.jsx)("div",{className:"mt-2 text-sm text-red-700",children:m})]})]})}),(0,n.jsx)("div",{className:"bg-white shadow rounded-lg",children:(0,n.jsx)("div",{className:"px-6 py-8",children:(0,n.jsx)(r.p,{onSubmit:x,isLoading:u,submitButtonText:"Create Donation Link"})})}),(0,n.jsxs)("div",{className:"mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6",children:[(0,n.jsx)("h3",{className:"text-lg font-medium text-blue-900 mb-3",children:"\uD83D\uDCA1 Tips for a Great Donation Page"}),(0,n.jsxs)("ul",{className:"space-y-2 text-sm text-blue-800",children:[(0,n.jsxs)("li",{children:["• ",(0,n.jsx)("strong",{children:"Clear Title:"})," Make it obvious what the donations are for"]}),(0,n.jsxs)("li",{children:["• ",(0,n.jsx)("strong",{children:"Compelling Description:"})," Explain why people should support you"]}),(0,n.jsxs)("li",{children:["• ",(0,n.jsx)("strong",{children:"Custom URL:"}),' Choose something memorable and easy to share (e.g., "my-stream", "support-me")']}),(0,n.jsxs)("li",{children:["• ",(0,n.jsx)("strong",{children:"Theme Colors:"})," Match your brand or stream aesthetic"]}),(0,n.jsxs)("li",{children:["• ",(0,n.jsx)("strong",{children:"Anonymous Donations:"})," Allow anonymous giving to increase participation"]})]})]})]})}):(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-red-500 text-6xl mb-4",children:"\uD83D\uDEAB"}),(0,n.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),(0,n.jsx)("p",{className:"text-gray-600 mb-4",children:"You need to be logged in as a streamer to create donation links."}),(0,n.jsx)("button",{onClick:()=>e.push("/login"),className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:"Go to Login"})]})})}},61414:function(e,t,i){"use strict";i.d(t,{HB:function(){return d},qr:function(){return o},tN:function(){return l}});var n=i(8433),s=i(31421),a=i(30189);let r={user:null,isAuthenticated:!1,wallet:null,transactions:[],donations:[],donationLinks:[],recentDonations:[],obsSettings:null,dashboardStats:null,isLoading:!1,error:null},o=(0,n.Ue)()((0,s.mW)((0,s.tJ)((e,t)=>({...r,setUser:t=>e({user:t,isAuthenticated:!!t}),setAuthenticated:t=>e({isAuthenticated:t}),refreshUser:async()=>{try{let{isValid:t,user:i}=await (0,a.validateAuthToken)();t&&i&&e({user:i,isAuthenticated:!0})}catch(e){console.error("Failed to refresh user data:",e)}},updateUserRole:i=>{let{user:n}=t();n&&e({user:{...n,role:i}})},initializeAuth:async()=>{try{if(console.log("Initializing authentication..."),(0,a.pw)()){console.log("Token is expired, clearing auth state"),(0,a.H6)(),e({user:null,isAuthenticated:!1});return}let{isValid:t,user:i}=await (0,a.validateAuthToken)();console.log("Token validation result:",{isValid:t,user:i?"exists":"null"}),t&&i?(console.log("Setting authenticated user:",i.name),e({user:i,isAuthenticated:!0})):(console.log("Token invalid, clearing auth state"),(0,a.H6)(),e({user:null,isAuthenticated:!1}))}catch(t){console.error("Authentication initialization error:",t),(0,a.H6)(),e({user:null,isAuthenticated:!1})}},setWallet:t=>e({wallet:t}),updateWalletBalance:i=>{let{wallet:n}=t();n&&e({wallet:{...n,balance:n.balance+i}})},addTransaction:i=>{let{transactions:n}=t();e({transactions:[i,...n]})},setTransactions:t=>e({transactions:t}),addDonation:i=>{let{donations:n,recentDonations:s}=t();e({donations:[i,...n],recentDonations:[i,...s.slice(0,9)]})},setDonations:t=>e({donations:t}),addDonationLink:i=>{let{donationLinks:n}=t();e({donationLinks:[i,...n||[]]})},updateDonationLink:(i,n)=>{let{donationLinks:s}=t();e({donationLinks:(s||[]).map(e=>e.id===i?{...e,...n}:e)})},removeDonationLink:i=>{let{donationLinks:n}=t();e({donationLinks:(n||[]).filter(e=>e.id!==i)})},setDonationLinks:t=>e({donationLinks:t||[]}),setOBSSettings:t=>e({obsSettings:t}),updateOBSSettings:i=>{let{obsSettings:n}=t();n&&e({obsSettings:{...n,...i}})},setDashboardStats:t=>e({dashboardStats:t}),setLoading:t=>e({isLoading:t}),setError:t=>e({error:t}),clearError:()=>e({error:null}),reset:()=>e(r)}),{name:"auth-store",partialize:e=>({user:e.user,isAuthenticated:e.isAuthenticated,wallet:e.wallet,transactions:e.transactions,donations:e.donations,donationLinks:e.donationLinks,obsSettings:e.obsSettings})}))),l=(0,n.Ue)()((0,s.mW)((0,s.tJ)(e=>({isAuthenticating:!1,authError:null,login:async(t,i)=>{e({isAuthenticating:!0,authError:null});try{let e=await a.x1.auth.login(t,i);if(e&&e.access_token&&e.user)(0,a.uB)(e.access_token),o.getState().setUser(e.user),o.getState().setAuthenticated(!0);else throw Error("Invalid response format")}catch(i){var n,s;let t=(null===(s=i.response)||void 0===s?void 0:null===(n=s.data)||void 0===n?void 0:n.message)||i.message||"Login failed";throw e({authError:t}),Error(t)}finally{e({isAuthenticating:!1})}},register:async t=>{e({isAuthenticating:!0,authError:null});try{let e=t.name.trim().split(" "),i=e[0]||"",n=e.slice(1).join(" ")||"";if(i&&!n&&(n="User"),i.length<2)throw Error("First name must be at least 2 characters long");if(n.length<2)throw Error("Last name must be at least 2 characters long");let s={email:t.email,password:t.password,firstName:i,lastName:n,role:t.role},r=await a.x1.auth.register(s.email,s.password,s.firstName,s.lastName,s.role);if(r&&r.access_token&&r.user)(0,a.uB)(r.access_token),o.getState().setUser(r.user),o.getState().setAuthenticated(!0);else throw Error("Registration failed")}catch(s){var i,n;let t=(null===(n=s.response)||void 0===n?void 0:null===(i=n.data)||void 0===i?void 0:i.message)||s.message||"Registration failed";throw e({authError:t}),Error(t)}finally{e({isAuthenticating:!1})}},logout:()=>{a.x1.auth.logout().catch(console.error),(0,a.H6)(),o.getState().reset(),e({isAuthenticating:!1,authError:null})},forgotPassword:async t=>{e({isAuthenticating:!0,authError:null});try{await new Promise(e=>setTimeout(e,1e3))}catch(s){var i,n;let t=(null===(n=s.response)||void 0===n?void 0:null===(i=n.data)||void 0===i?void 0:i.message)||s.message||"Failed to send reset email";throw e({authError:t}),Error(t)}finally{e({isAuthenticating:!1})}},resetPassword:async(t,i)=>{e({isAuthenticating:!0,authError:null});try{await new Promise(e=>setTimeout(e,1e3))}catch(i){var n,s;let t=(null===(s=i.response)||void 0===s?void 0:null===(n=s.data)||void 0===n?void 0:n.message)||i.message||"Failed to reset password";throw e({authError:t}),Error(t)}finally{e({isAuthenticating:!1})}},verifyEmail:async t=>{e({isAuthenticating:!0,authError:null});try{await new Promise(e=>setTimeout(e,1e3))}catch(s){var i,n;let t=(null===(n=s.response)||void 0===n?void 0:null===(i=n.data)||void 0===i?void 0:i.message)||s.message||"Failed to verify email";throw e({authError:t}),Error(t)}finally{e({isAuthenticating:!1})}}}),{name:"auth-store",partialize:e=>({isAuthenticating:e.isAuthenticating,authError:e.authError})}))),d=(0,n.Ue)()((0,s.mW)((0,s.tJ)(e=>({sidebarOpen:!1,theme:"light",notifications:[],toggleSidebar:()=>e(e=>({sidebarOpen:!e.sidebarOpen})),setTheme:t=>e({theme:t}),addNotification:t=>e(e=>({notifications:[{...t,id:Date.now().toString(),timestamp:new Date},...e.notifications]})),removeNotification:t=>e(e=>({notifications:e.notifications.filter(e=>e.id!==t)})),clearNotifications:()=>e({notifications:[]})}),{name:"ui-store",partialize:e=>({theme:e.theme})})))},46179:function(e,t,i){e.exports=i(70319)}},function(e){e.O(0,[4885,4952,189,9788,7115,141,1744],function(){return e(e.s=67852)}),_N_E=e.O()}]);