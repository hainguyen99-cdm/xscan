(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5793],{87057:function(e,t,n){Promise.resolve().then(n.bind(n,82545))},82545:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return r}});var a=n(37821),i=n(58078),s=n(61414),o=n(30189);function r(){let{user:e,isAuthenticated:t}=(0,s.qr)(),{isAuthenticating:n}=(0,s.tN)(),[r,l]=(0,i.useState)(null),[c,d]=(0,i.useState)(null);(0,i.useEffect)(()=>{l((0,o.hV)())},[]);let u=async()=>{try{let e=await fetch("/api/auth/profile",{headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"}});if(e.ok){let t=await e.json();d(t)}else d({error:"HTTP ".concat(e.status,": ").concat(e.statusText)})}catch(e){d({error:e instanceof Error?e.message:"Unknown error"})}};return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 p-8",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"Donation Auth Test Page"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Authentication State"}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"isAuthenticating:"})," ",n?"true":"false"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"isAuthenticated:"})," ",t?"true":"false"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"User:"})," ",e?JSON.stringify(e,null,2):"null"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"User Role:"})," ",(null==e?void 0:e.role)||"none"]})]})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Token Information"}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Stored Token:"})," ",r?"".concat(r.substring(0,20),"..."):"none"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Token Length:"})," ",(null==r?void 0:r.length)||0]})]}),(0,a.jsx)("button",{onClick:u,className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Test Profile API"}),(0,a.jsx)("button",{onClick:()=>{let e="mock-token-for-testing";document.cookie="auth-token=".concat(e,"; path=/; max-age=").concat(86400,"; SameSite=Lax"),localStorage.setItem("auth-token",e),l(e),window.location.reload()},className:"mt-4 ml-2 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:"Simulate Auth"})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow md:col-span-2",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Profile API Response"}),(0,a.jsx)("pre",{className:"bg-gray-100 p-4 rounded text-xs overflow-auto",children:c?JSON.stringify(c,null,2):"No response yet"})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow md:col-span-2",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Quick Actions"}),(0,a.jsxs)("div",{className:"space-x-4",children:[(0,a.jsx)("a",{href:"/donation-links/create",className:"inline-block px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:"Try Donation Links Create"}),(0,a.jsx)("a",{href:"/dashboard/donation-links",className:"inline-block px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Try Donation Links Dashboard"})]})]})]})]})})}},61414:function(e,t,n){"use strict";n.d(t,{HB:function(){return c},qr:function(){return r},tN:function(){return l}});var a=n(8433),i=n(31421),s=n(30189);let o={user:null,isAuthenticated:!1,wallet:null,transactions:[],donations:[],donationLinks:[],recentDonations:[],obsSettings:null,dashboardStats:null,isLoading:!1,error:null},r=(0,a.Ue)()((0,i.mW)((0,i.tJ)((e,t)=>({...o,setUser:t=>e({user:t,isAuthenticated:!!t}),setAuthenticated:t=>e({isAuthenticated:t}),refreshUser:async()=>{try{let{isValid:t,user:n}=await (0,s.validateAuthToken)();t&&n&&e({user:n,isAuthenticated:!0})}catch(e){console.error("Failed to refresh user data:",e)}},updateUserRole:n=>{let{user:a}=t();a&&e({user:{...a,role:n}})},initializeAuth:async()=>{try{if(console.log("Initializing authentication..."),(0,s.pw)()){console.log("Token is expired, clearing auth state"),(0,s.H6)(),e({user:null,isAuthenticated:!1});return}let{isValid:t,user:n}=await (0,s.validateAuthToken)();console.log("Token validation result:",{isValid:t,user:n?"exists":"null"}),t&&n?(console.log("Setting authenticated user:",n.name),e({user:n,isAuthenticated:!0})):(console.log("Token invalid, clearing auth state"),(0,s.H6)(),e({user:null,isAuthenticated:!1}))}catch(t){console.error("Authentication initialization error:",t),(0,s.H6)(),e({user:null,isAuthenticated:!1})}},setWallet:t=>e({wallet:t}),updateWalletBalance:n=>{let{wallet:a}=t();a&&e({wallet:{...a,balance:a.balance+n}})},addTransaction:n=>{let{transactions:a}=t();e({transactions:[n,...a]})},setTransactions:t=>e({transactions:t}),addDonation:n=>{let{donations:a,recentDonations:i}=t();e({donations:[n,...a],recentDonations:[n,...i.slice(0,9)]})},setDonations:t=>e({donations:t}),addDonationLink:n=>{let{donationLinks:a}=t();e({donationLinks:[n,...a||[]]})},updateDonationLink:(n,a)=>{let{donationLinks:i}=t();e({donationLinks:(i||[]).map(e=>e.id===n?{...e,...a}:e)})},removeDonationLink:n=>{let{donationLinks:a}=t();e({donationLinks:(a||[]).filter(e=>e.id!==n)})},setDonationLinks:t=>e({donationLinks:t||[]}),setOBSSettings:t=>e({obsSettings:t}),updateOBSSettings:n=>{let{obsSettings:a}=t();a&&e({obsSettings:{...a,...n}})},setDashboardStats:t=>e({dashboardStats:t}),setLoading:t=>e({isLoading:t}),setError:t=>e({error:t}),clearError:()=>e({error:null}),reset:()=>e(o)}),{name:"auth-store",partialize:e=>({user:e.user,isAuthenticated:e.isAuthenticated,wallet:e.wallet,transactions:e.transactions,donations:e.donations,donationLinks:e.donationLinks,obsSettings:e.obsSettings})}))),l=(0,a.Ue)()((0,i.mW)((0,i.tJ)(e=>({isAuthenticating:!1,authError:null,login:async(t,n)=>{e({isAuthenticating:!0,authError:null});try{let e=await s.x1.auth.login(t,n);if(e&&e.access_token&&e.user)(0,s.uB)(e.access_token),r.getState().setUser(e.user),r.getState().setAuthenticated(!0);else throw Error("Invalid response format")}catch(n){var a,i;let t=(null===(i=n.response)||void 0===i?void 0:null===(a=i.data)||void 0===a?void 0:a.message)||n.message||"Login failed";throw e({authError:t}),Error(t)}finally{e({isAuthenticating:!1})}},register:async t=>{e({isAuthenticating:!0,authError:null});try{let e=t.name.trim().split(" "),n=e[0]||"",a=e.slice(1).join(" ")||"";if(n&&!a&&(a="User"),n.length<2)throw Error("First name must be at least 2 characters long");if(a.length<2)throw Error("Last name must be at least 2 characters long");let i={email:t.email,password:t.password,firstName:n,lastName:a,role:t.role},o=await s.x1.auth.register(i.email,i.password,i.firstName,i.lastName,i.role);if(o&&o.access_token&&o.user)(0,s.uB)(o.access_token),r.getState().setUser(o.user),r.getState().setAuthenticated(!0);else throw Error("Registration failed")}catch(i){var n,a;let t=(null===(a=i.response)||void 0===a?void 0:null===(n=a.data)||void 0===n?void 0:n.message)||i.message||"Registration failed";throw e({authError:t}),Error(t)}finally{e({isAuthenticating:!1})}},logout:()=>{s.x1.auth.logout().catch(console.error),(0,s.H6)(),r.getState().reset(),e({isAuthenticating:!1,authError:null})},forgotPassword:async t=>{e({isAuthenticating:!0,authError:null});try{await new Promise(e=>setTimeout(e,1e3))}catch(i){var n,a;let t=(null===(a=i.response)||void 0===a?void 0:null===(n=a.data)||void 0===n?void 0:n.message)||i.message||"Failed to send reset email";throw e({authError:t}),Error(t)}finally{e({isAuthenticating:!1})}},resetPassword:async(t,n)=>{e({isAuthenticating:!0,authError:null});try{await new Promise(e=>setTimeout(e,1e3))}catch(n){var a,i;let t=(null===(i=n.response)||void 0===i?void 0:null===(a=i.data)||void 0===a?void 0:a.message)||n.message||"Failed to reset password";throw e({authError:t}),Error(t)}finally{e({isAuthenticating:!1})}},verifyEmail:async t=>{e({isAuthenticating:!0,authError:null});try{await new Promise(e=>setTimeout(e,1e3))}catch(i){var n,a;let t=(null===(a=i.response)||void 0===a?void 0:null===(n=a.data)||void 0===n?void 0:n.message)||i.message||"Failed to verify email";throw e({authError:t}),Error(t)}finally{e({isAuthenticating:!1})}}}),{name:"auth-store",partialize:e=>({isAuthenticating:e.isAuthenticating,authError:e.authError})}))),c=(0,a.Ue)()((0,i.mW)((0,i.tJ)(e=>({sidebarOpen:!1,theme:"light",notifications:[],toggleSidebar:()=>e(e=>({sidebarOpen:!e.sidebarOpen})),setTheme:t=>e({theme:t}),addNotification:t=>e(e=>({notifications:[{...t,id:Date.now().toString(),timestamp:new Date},...e.notifications]})),removeNotification:t=>e(e=>({notifications:e.notifications.filter(e=>e.id!==t)})),clearNotifications:()=>e({notifications:[]})}),{name:"ui-store",partialize:e=>({theme:e.theme})})))}},function(e){e.O(0,[4885,4952,189,7115,141,1744],function(){return e(e.s=87057)}),_N_E=e.O()}]);