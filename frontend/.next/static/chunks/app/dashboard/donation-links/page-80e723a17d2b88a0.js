(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2609],{68229:function(e,t,n){Promise.resolve().then(n.bind(n,15893))},15893:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return m}});var r=n(37821),i=n(58078),s=n(46179),o=n(61414),a=n(30189),l=n(54377),d=n(83899),c=e=>{let{isOpen:t,onClose:n,onConfirm:i,title:s,message:o,confirmText:a="Confirm",cancelText:l="Cancel",confirmButtonVariant:d="primary"}=e;return t?(0,r.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,r.jsxs)("div",{className:"flex min-h-screen items-center justify-center p-4",children:[(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:n}),(0,r.jsxs)("div",{className:"relative bg-white rounded-lg shadow-xl max-w-md w-full mx-auto",onKeyDown:e=>{"Escape"===e.key&&n()},children:[(0,r.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:s})}),(0,r.jsx)("div",{className:"px-6 py-4",children:(0,r.jsx)("p",{className:"text-sm text-gray-600",children:o})}),(0,r.jsxs)("div",{className:"px-6 py-4 bg-gray-50 rounded-b-lg flex justify-end space-x-3",children:[(0,r.jsx)("button",{onClick:n,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:l}),(0,r.jsx)("button",{onClick:()=>{i(),n()},className:"px-4 py-2 text-sm font-medium text-white rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 ".concat("danger"===d?"bg-red-600 hover:bg-red-700 focus:ring-red-500":"bg-indigo-600 hover:bg-indigo-700 focus:ring-indigo-500"),children:a})]})]})]})}):null};function m(){var e;let t=(0,s.useRouter)(),{donationLinks:n,setDonationLinks:m,user:u,isAuthenticated:x}=(0,o.qr)(),{isAuthenticating:h}=(0,o.tN)(),[g,f]=(0,i.useState)(!0),[b,p]=(0,i.useState)(null),[y,j]=(0,i.useState)({isOpen:!1,link:null});(0,i.useEffect)(()=>{h||x&&((null==u?void 0:u.role)==="streamer"||(null==u?void 0:u.role)==="admin")||t.push("/login?redirect=/dashboard/donation-links")},[h,x,null==u?void 0:u.role,t]),(0,i.useEffect)(()=>{(async()=>{if(x&&((null==u?void 0:u.role)==="streamer"||(null==u?void 0:u.role)==="admin"))try{f(!0);let e=(0,a.hV)();if(!e)throw Error("Authentication required");let t=await fetch("/api/donation-links",{headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok)throw Error("Failed to fetch donation links");let n=await t.json(),r=[];n.data&&(n.data.donationLinks?r=n.data.donationLinks:Array.isArray(n.data)&&(r=n.data)),m(r)}catch(e){p(e instanceof Error?e.message:"Failed to fetch donation links")}finally{f(!1)}})()},[x,null==u?void 0:u.role,m]);let v=async e=>{try{let t=(0,a.hV)();if(!t)throw Error("Authentication required");if(!e.id)throw Error("Could not find donation link ID");let r=await fetch("/api/donation-links/".concat(e.id),{method:"DELETE",headers:{Authorization:"Bearer ".concat(t)}});if(!r.ok){let e=await r.json();throw Error(e.message||"Failed to delete donation link")}let i=(n||[]).filter(t=>t.id!==e.id);m(i)}catch(e){console.error("Failed to delete donation link:",e),alert(e instanceof Error?e.message:"Failed to delete donation link")}},w=async e=>{try{let t=(0,a.hV)();if(!t)throw Error("Authentication required");if(!e.id)throw Error("Could not find donation link ID");let r=await fetch("/api/donation-links/".concat(e.id,"/set-default"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(t)}});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(e.message||"Failed to set default link")}(await r.json()).data;let i=(n||[]).map(t=>({...t,isDefault:t.id===e.id}));m(i),(0,d.showToast)({type:"success",title:"Default link updated",message:'"'.concat(e.title,'" is now your default donation link.')})}catch(e){console.error("Failed to set default donation link:",e),(0,d.showToast)({type:"error",title:"Failed to set default",message:e instanceof Error?e.message:"Unexpected error"})}};return h?(0,r.jsx)(l.Z,{children:(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading..."})]})})}):x&&((null==u?void 0:u.role)==="streamer"||(null==u?void 0:u.role)==="admin")?(0,r.jsxs)(l.Z,{children:[(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,r.jsx)("div",{className:"mb-8",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Donation Links"}),(0,r.jsx)("p",{className:"mt-2 text-gray-600",children:"Manage your donation pages and track their performance."})]}),(0,r.jsxs)("button",{onClick:()=>t.push("/donation-links/create"),className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[(0,r.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Create New Link"]})]})}),b&&(0,r.jsx)("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-md p-4",children:(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),(0,r.jsx)("div",{className:"mt-2 text-sm text-red-700",children:b})]})]})}),g&&(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading donation links..."})]}),!g&&(0,r.jsx)(r.Fragment,{children:0===(n||[]).length?(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("div",{className:"text-gray-400 text-6xl mb-4",children:"\uD83D\uDD17"}),(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No donation links yet"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"Create your first donation link to start receiving support from your audience."}),(0,r.jsx)("button",{onClick:()=>t.push("/donation-links/create"),className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Create Your First Link"})]}):(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:(n||[]).map(e=>(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:e.title}),e.description&&(0,r.jsx)("p",{className:"text-sm text-gray-600 line-clamp-2",children:e.description})]}),(0,r.jsx)("div",{className:"ml-3 px-2 py-1 rounded-full text-xs font-medium ".concat(e.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.isActive?"Active":"Inactive"})]}),(0,r.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"URL:"}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("code",{className:"flex-1 bg-gray-100 px-3 py-2 rounded-md text-xs font-mono break-all",children:"".concat(window.location.origin,"/donate/").concat(e.customUrl)}),(0,r.jsx)("button",{onClick:async()=>{let t=window.location.origin,n="".concat(t,"/donate/").concat(e.customUrl);try{await navigator.clipboard.writeText(n),console.log("Link copied to clipboard")}catch(e){console.error("Failed to copy link:",e)}},className:"flex-shrink-0 px-2 py-2 text-xs font-medium text-gray-600 bg-gray-50 border border-gray-200 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",title:"Copy link to clipboard",children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]})]}),(0,r.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,r.jsx)("span",{className:"font-medium mr-2",children:"Anonymous:"}),(0,r.jsx)("span",{className:e.allowAnonymous?"text-green-600":"text-red-600",children:e.allowAnonymous?"Allowed":"Not allowed"})]}),(0,r.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,r.jsx)("span",{className:"font-medium mr-2",children:"Created:"}),(0,r.jsx)("span",{children:new Date(e.createdAt).toLocaleDateString()})]})]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{onClick:()=>{let t=window.location.origin,n="".concat(t,"/donate/").concat(e.customUrl);window.open(n,"_blank")},className:"flex-1 px-3 py-2 text-sm font-medium text-indigo-600 bg-indigo-50 border border-indigo-200 rounded-md hover:bg-indigo-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"View Page"}),(0,r.jsx)("button",{onClick:()=>w(e),className:"px-3 py-2 text-sm font-medium rounded-md border ".concat(e.isDefault?"text-emerald-700 bg-emerald-50 border-emerald-200":"text-gray-600 bg-gray-50 border-gray-200 hover:bg-gray-100"," focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500"),title:"Set as default link","aria-pressed":e.isDefault,children:e.isDefault?"Default":"Set Default"}),(0,r.jsx)("button",{onClick:()=>{if(!e.id){console.error("No valid ID found for donation link:",e),alert("Error: Could not find donation link ID");return}t.push("/dashboard/donation-links/".concat(e.id,"/edit"))},className:"px-3 py-2 text-sm font-medium text-gray-600 bg-gray-50 border border-gray-200 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:"Edit"}),(0,r.jsx)("button",{onClick:()=>j({isOpen:!0,link:e}),className:"px-3 py-2 text-sm font-medium text-red-600 bg-red-50 border border-red-200 rounded-md hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",title:"Delete donation link",children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},e.id||e._id))})})]})}),(0,r.jsx)(c,{isOpen:y.isOpen,onClose:()=>j({isOpen:!1,link:null}),onConfirm:()=>{y.link&&v(y.link)},title:"Delete Donation Link",message:'Are you sure you want to delete "'.concat(null===(e=y.link)||void 0===e?void 0:e.title,'"? This action cannot be undone and will permanently remove the donation link.'),confirmText:"Delete",cancelText:"Cancel",confirmButtonVariant:"danger"})]}):(0,r.jsx)(l.Z,{children:(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-red-500 text-6xl mb-4",children:"\uD83D\uDEAB"}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"You need to be logged in as a streamer or admin to view donation links."}),(0,r.jsx)("button",{onClick:()=>t.push("/login"),className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:"Go to Login"})]})})})}},54377:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(37821);n(58078);var i=n(61414),s=n(64944);function o(e){let{children:t}=e,{sidebarOpen:n,toggleSidebar:o}=(0,i.HB)();return(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-white to-cyan-50",children:[(0,r.jsx)(s.Header,{}),(0,r.jsx)("main",{className:"relative",children:t})]})}},83899:function(e,t,n){"use strict";n.r(t),n.d(t,{ToastContainer:function(){return a},showToast:function(){return l}});var r=n(37821),i=n(58078),s=n(40457);function o(e){let{toast:t,onRemove:n}=e;return(0,i.useEffect)(()=>{let e=setTimeout(()=>{n(t.id)},t.duration||5e3);return()=>clearTimeout(e)},[t.id,t.duration,n]),(0,r.jsx)("div",{className:"".concat((()=>{switch(t.type){case"success":return"bg-green-50 border-green-200 text-green-800";case"error":return"bg-red-50 border-red-200 text-red-800";case"warning":return"bg-yellow-50 border-yellow-200 text-yellow-800";case"info":return"bg-blue-50 border-blue-200 text-blue-800";default:return"bg-gray-50 border-gray-200 text-gray-800"}})()," border rounded-lg p-4 shadow-lg max-w-sm w-full transition-all duration-300 ease-in-out transform translate-x-0 opacity-100"),children:(0,r.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,r.jsx)("span",{className:"text-lg",children:(()=>{switch(t.type){case"success":return"✅";case"error":return"❌";case"warning":return"⚠️";default:return"ℹ️"}})()}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("p",{className:"font-medium text-sm",children:t.title}),t.message&&(0,r.jsx)("p",{className:"text-sm mt-1 opacity-90",children:t.message})]}),(0,r.jsx)("button",{onClick:()=>n(t.id),className:"text-gray-400 hover:text-gray-600 transition-colors",children:"✕"})]})})}function a(){let[e,t]=(0,i.useState)([]),n=e=>{t(t=>t.filter(t=>t.id!==e))},a=e=>{let n=Math.random().toString(36).substr(2,9);t(t=>[...t,{...e,id:n}])};return(0,i.useEffect)(()=>(window.showToast=a,()=>{delete window.showToast}),[]),(0,s.createPortal)((0,r.jsx)("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:e.map(e=>(0,r.jsx)(o,{toast:e,onRemove:n},e.id))}),document.body)}let l=e=>{window.showToast&&window.showToast(e)}}},function(e){e.O(0,[4885,4952,5052,189,4944,7115,141,1744],function(){return e(e.s=68229)}),_N_E=e.O()}]);