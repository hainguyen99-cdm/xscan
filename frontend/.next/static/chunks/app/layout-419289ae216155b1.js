(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3185],{51004:function(t,e,n){Promise.resolve().then(n.t.bind(n,97732,23)),Promise.resolve().then(n.bind(n,13428)),Promise.resolve().then(n.bind(n,83899))},13428:function(t,e,n){"use strict";n.r(e),n.d(e,{Providers:function(){return d}});var i=n(37821),a=n(40935),r=n(89188),s=n(58078),o=n(46179),l=n(61414);function c(t){let{children:e}=t,{isAuthenticated:n,initializeAuth:a}=(0,l.qr)(),[r,c]=(0,s.useState)(!0),[u,d]=(0,s.useState)(!1),[h,g]=(0,s.useState)(null),m=(0,o.useRouter)(),f=(0,o.usePathname)(),w=["/login","/register","/forgot-password","/reset-password"],v=["/login","/forgot-password","/reset-password"],p=(0,s.useCallback)(async()=>{try{console.log("Starting authentication initialization..."),g(null),await a(),console.log("Authentication initialization completed")}catch(t){console.error("Failed to initialize authentication:",t),g(t instanceof Error?t.message:"Authentication failed")}finally{c(!1),d(!0)}},[a]);return((0,s.useEffect)(()=>{p()},[p]),(0,s.useEffect)(()=>{if(!r&&u){console.log("Running authentication checks for path:",f);let t=setTimeout(()=>{let t=w.includes(f),e=v.includes(f);console.log("Auth state check:",{isAuthenticated:n,pathname:f,isPublicRoute:t,isLoginOnlyRoute:e,authError:h}),n||t?n&&e&&(console.log("Redirecting to dashboard: authenticated on login-only route"),m.push("/dashboard")):(console.log("Redirecting to login: not authenticated on protected route"),m.push("/login"))},150);return()=>clearTimeout(t)}},[n,f,r,u,m,w,v,h]),(0,s.useEffect)(()=>{if(!n||r)return;let t=setInterval(async()=>{try{console.log("Performing periodic token validation..."),await a()}catch(t){console.error("Periodic token validation failed:",t),g("Token validation failed")}},3e5);return()=>clearInterval(t)},[n,r,a]),r)?(0,i.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),(0,i.jsx)("p",{className:"text-gray-600",children:"Initializing..."}),h&&(0,i.jsx)("p",{className:"text-red-500 text-sm mt-2",children:h})]})}):(0,i.jsx)(i.Fragment,{children:e})}let u=new a.S({defaultOptions:{queries:{retry:1,refetchOnWindowFocus:!1}}});function d(t){let{children:e}=t;return(0,i.jsx)(r.aH,{client:u,children:(0,i.jsx)(c,{children:e})})}},83899:function(t,e,n){"use strict";n.r(e),n.d(e,{ToastContainer:function(){return o},showToast:function(){return l}});var i=n(37821),a=n(58078),r=n(40457);function s(t){let{toast:e,onRemove:n}=t;return(0,a.useEffect)(()=>{let t=setTimeout(()=>{n(e.id)},e.duration||5e3);return()=>clearTimeout(t)},[e.id,e.duration,n]),(0,i.jsx)("div",{className:"".concat((()=>{switch(e.type){case"success":return"bg-green-50 border-green-200 text-green-800";case"error":return"bg-red-50 border-red-200 text-red-800";case"warning":return"bg-yellow-50 border-yellow-200 text-yellow-800";case"info":return"bg-blue-50 border-blue-200 text-blue-800";default:return"bg-gray-50 border-gray-200 text-gray-800"}})()," border rounded-lg p-4 shadow-lg max-w-sm w-full transition-all duration-300 ease-in-out transform translate-x-0 opacity-100"),children:(0,i.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,i.jsx)("span",{className:"text-lg",children:(()=>{switch(e.type){case"success":return"✅";case"error":return"❌";case"warning":return"⚠️";default:return"ℹ️"}})()}),(0,i.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,i.jsx)("p",{className:"font-medium text-sm",children:e.title}),e.message&&(0,i.jsx)("p",{className:"text-sm mt-1 opacity-90",children:e.message})]}),(0,i.jsx)("button",{onClick:()=>n(e.id),className:"text-gray-400 hover:text-gray-600 transition-colors",children:"✕"})]})})}function o(){let[t,e]=(0,a.useState)([]),n=t=>{e(e=>e.filter(e=>e.id!==t))},o=t=>{let n=Math.random().toString(36).substr(2,9);e(e=>[...e,{...t,id:n}])};return(0,a.useEffect)(()=>(window.showToast=o,()=>{delete window.showToast}),[]),(0,r.createPortal)((0,i.jsx)("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:t.map(t=>(0,i.jsx)(s,{toast:t,onRemove:n},t.id))}),document.body)}let l=t=>{window.showToast&&window.showToast(t)}},61414:function(t,e,n){"use strict";n.d(e,{HB:function(){return c},qr:function(){return o},tN:function(){return l}});var i=n(8433),a=n(31421),r=n(30189);let s={user:null,isAuthenticated:!1,wallet:null,transactions:[],donations:[],donationLinks:[],recentDonations:[],obsSettings:null,dashboardStats:null,isLoading:!1,error:null},o=(0,i.Ue)()((0,a.mW)((0,a.tJ)((t,e)=>({...s,setUser:e=>t({user:e,isAuthenticated:!!e}),setAuthenticated:e=>t({isAuthenticated:e}),refreshUser:async()=>{try{let{isValid:e,user:n}=await (0,r.validateAuthToken)();e&&n&&t({user:n,isAuthenticated:!0})}catch(t){console.error("Failed to refresh user data:",t)}},updateUserRole:n=>{let{user:i}=e();i&&t({user:{...i,role:n}})},initializeAuth:async()=>{try{if(console.log("Initializing authentication..."),(0,r.pw)()){console.log("Token is expired, clearing auth state"),(0,r.H6)(),t({user:null,isAuthenticated:!1});return}let{isValid:e,user:n}=await (0,r.validateAuthToken)();console.log("Token validation result:",{isValid:e,user:n?"exists":"null"}),e&&n?(console.log("Setting authenticated user:",n.name),t({user:n,isAuthenticated:!0})):(console.log("Token invalid, clearing auth state"),(0,r.H6)(),t({user:null,isAuthenticated:!1}))}catch(e){console.error("Authentication initialization error:",e),(0,r.H6)(),t({user:null,isAuthenticated:!1})}},setWallet:e=>t({wallet:e}),updateWalletBalance:n=>{let{wallet:i}=e();i&&t({wallet:{...i,balance:i.balance+n}})},addTransaction:n=>{let{transactions:i}=e();t({transactions:[n,...i]})},setTransactions:e=>t({transactions:e}),addDonation:n=>{let{donations:i,recentDonations:a}=e();t({donations:[n,...i],recentDonations:[n,...a.slice(0,9)]})},setDonations:e=>t({donations:e}),addDonationLink:n=>{let{donationLinks:i}=e();t({donationLinks:[n,...i||[]]})},updateDonationLink:(n,i)=>{let{donationLinks:a}=e();t({donationLinks:(a||[]).map(t=>t.id===n?{...t,...i}:t)})},removeDonationLink:n=>{let{donationLinks:i}=e();t({donationLinks:(i||[]).filter(t=>t.id!==n)})},setDonationLinks:e=>t({donationLinks:e||[]}),setOBSSettings:e=>t({obsSettings:e}),updateOBSSettings:n=>{let{obsSettings:i}=e();i&&t({obsSettings:{...i,...n}})},setDashboardStats:e=>t({dashboardStats:e}),setLoading:e=>t({isLoading:e}),setError:e=>t({error:e}),clearError:()=>t({error:null}),reset:()=>t(s)}),{name:"auth-store",partialize:t=>({user:t.user,isAuthenticated:t.isAuthenticated,wallet:t.wallet,transactions:t.transactions,donations:t.donations,donationLinks:t.donationLinks,obsSettings:t.obsSettings})}))),l=(0,i.Ue)()((0,a.mW)((0,a.tJ)(t=>({isAuthenticating:!1,authError:null,login:async(e,n)=>{t({isAuthenticating:!0,authError:null});try{let t=await r.x1.auth.login(e,n);if(t&&t.access_token&&t.user)(0,r.uB)(t.access_token),o.getState().setUser(t.user),o.getState().setAuthenticated(!0);else throw Error("Invalid response format")}catch(n){var i,a;let e=(null===(a=n.response)||void 0===a?void 0:null===(i=a.data)||void 0===i?void 0:i.message)||n.message||"Login failed";throw t({authError:e}),Error(e)}finally{t({isAuthenticating:!1})}},register:async e=>{t({isAuthenticating:!0,authError:null});try{let t=e.name.trim().split(" "),n=t[0]||"",i=t.slice(1).join(" ")||"";if(n&&!i&&(i="User"),n.length<2)throw Error("First name must be at least 2 characters long");if(i.length<2)throw Error("Last name must be at least 2 characters long");let a={email:e.email,password:e.password,firstName:n,lastName:i,role:e.role},s=await r.x1.auth.register(a.email,a.password,a.firstName,a.lastName,a.role);if(s&&s.access_token&&s.user)(0,r.uB)(s.access_token),o.getState().setUser(s.user),o.getState().setAuthenticated(!0);else throw Error("Registration failed")}catch(a){var n,i;let e=(null===(i=a.response)||void 0===i?void 0:null===(n=i.data)||void 0===n?void 0:n.message)||a.message||"Registration failed";throw t({authError:e}),Error(e)}finally{t({isAuthenticating:!1})}},logout:()=>{r.x1.auth.logout().catch(console.error),(0,r.H6)(),o.getState().reset(),t({isAuthenticating:!1,authError:null})},forgotPassword:async e=>{t({isAuthenticating:!0,authError:null});try{await new Promise(t=>setTimeout(t,1e3))}catch(a){var n,i;let e=(null===(i=a.response)||void 0===i?void 0:null===(n=i.data)||void 0===n?void 0:n.message)||a.message||"Failed to send reset email";throw t({authError:e}),Error(e)}finally{t({isAuthenticating:!1})}},resetPassword:async(e,n)=>{t({isAuthenticating:!0,authError:null});try{await new Promise(t=>setTimeout(t,1e3))}catch(n){var i,a;let e=(null===(a=n.response)||void 0===a?void 0:null===(i=a.data)||void 0===i?void 0:i.message)||n.message||"Failed to reset password";throw t({authError:e}),Error(e)}finally{t({isAuthenticating:!1})}},verifyEmail:async e=>{t({isAuthenticating:!0,authError:null});try{await new Promise(t=>setTimeout(t,1e3))}catch(a){var n,i;let e=(null===(i=a.response)||void 0===i?void 0:null===(n=i.data)||void 0===n?void 0:n.message)||a.message||"Failed to verify email";throw t({authError:e}),Error(e)}finally{t({isAuthenticating:!1})}}}),{name:"auth-store",partialize:t=>({isAuthenticating:t.isAuthenticating,authError:t.authError})}))),c=(0,i.Ue)()((0,a.mW)((0,a.tJ)(t=>({sidebarOpen:!1,theme:"light",notifications:[],toggleSidebar:()=>t(t=>({sidebarOpen:!t.sidebarOpen})),setTheme:e=>t({theme:e}),addNotification:e=>t(t=>({notifications:[{...e,id:Date.now().toString(),timestamp:new Date},...t.notifications]})),removeNotification:e=>t(t=>({notifications:t.notifications.filter(t=>t.id!==e)})),clearNotifications:()=>t({notifications:[]})}),{name:"ui-store",partialize:t=>({theme:t.theme})})))},97732:function(){}},function(t){t.O(0,[4885,4952,9250,189,7115,141,1744],function(){return t(t.s=51004)}),_N_E=t.O()}]);