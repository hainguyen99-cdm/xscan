(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2070],{39160:function(e,t,o){Promise.resolve().then(o.bind(o,96887))},96887:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return d},dynamic:function(){return r}});var n=o(37821),i=o(58078),a=o(55930),l=o(2155);let r="force-dynamic",s=async e=>(await new Promise(e=>setTimeout(e,100)),{_id:"1",streamerId:e,alertToken:"alert_token_12345",widgetUrl:"https://xscan.com/widget/alert/".concat(e),imageSettings:{enabled:!0,url:"https://via.placeholder.com/300x200/3b82f6/ffffff?text=Donation+Alert",mediaType:"image",width:300,height:80,borderRadius:8,shadow:!0,shadowColor:"#000000",shadowBlur:6,shadowOffsetX:1,shadowOffsetY:1},soundSettings:{enabled:!0,url:"https://www.soundjay.com/misc/sounds/bell-ringing-05.wav",volume:80,fadeIn:0,fadeOut:0,loop:!1},animationSettings:{enabled:!0,animationType:"fade",duration:500,easing:"ease-out",direction:"right",bounceIntensity:20,zoomScale:1.2},styleSettings:{backgroundColor:"#1a1a1a",textColor:"#ffffff",accentColor:"#3b82f6",borderColor:"#3b82f6",borderWidth:2,borderStyle:"solid",fontFamily:"Inter, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif",fontSize:16,fontWeight:"normal",fontStyle:"normal",textShadow:!0,textShadowColor:"#000000",textShadowBlur:3,textShadowOffsetX:1,textShadowOffsetY:1},positionSettings:{x:0,y:0,anchor:"top-right",zIndex:1e3,responsive:!0,mobileScale:.8},displaySettings:{duration:5e3,fadeInDuration:300,fadeOutDuration:300,autoHide:!0,showProgress:!1,progressColor:"#3b82f6",progressHeight:3},generalSettings:{enabled:!0,maxAlerts:3,alertSpacing:20,cooldown:1e3,priority:"medium"},isActive:!0,lastUsedAt:new Date().toISOString(),totalAlerts:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),customization:{image:{url:"https://via.placeholder.com/300x200/3b82f6/ffffff?text=Donation+Alert",type:"image",duration:5},sound:{url:"https://www.soundjay.com/misc/sounds/bell-ringing-05.wav",volume:80,duration:3},text:{font:"Inter",fontSize:16,color:"#ffffff",backgroundColor:"#1a1a1a",animation:"fade"},position:"top-right",duration:5e3}});function d(e){var t,o,r,d,u,c,m,f,g,v,p,h,x,w,b,S,y,D,N,j;let{params:I}=e,[z,C]=(0,i.useState)(null),[A,k]=(0,i.useState)(!0),[E,T]=(0,i.useState)(null),[O,_]=(0,i.useState)(!1),[B,R]=(0,i.useState)(null),[F,P]=(0,i.useState)(!1),[W,q]=(0,i.useState)([]),H=(0,i.useRef)(null),U=e=>{if(console.log("\uD83D\uDCE5 Adding alert to queue:",e.donorName,"- Queue length:",W.length),W.some(t=>t.alertId===e.alertId||t.donorName===e.donorName&&t.amount===e.amount&&1e3>Math.abs(new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime()))){console.log("\uD83D\uDEAB Duplicate alert detected, skipping:",e.donorName);return}if(E&&E.alertId===e.alertId){console.log("\uD83D\uDEAB Alert currently showing, skipping:",e.donorName);return}q(t=>{let o=Date.now(),n=[...t.filter(e=>o-new Date(e.timestamp).getTime()<3e4),e];return E||O?console.log("⏳ Alert queued - current alert is showing"):(console.log("\uD83D\uDE80 Starting queue processing - no alert currently showing"),setTimeout(()=>L(),0)),n})},L=()=>{console.log("\uD83D\uDD04 Processing next alert in queue"),q(e=>{var t,o;if(0===e.length)return console.log("✅ Queue empty - no more alerts to process"),T(null),_(!1),[];let n=e[0],i=e.slice(1);return console.log("\uD83C\uDFAF Showing alert:",n.donorName,"- Remaining in queue:",i.length),T(n),_(!0),H.current&&(null==z?void 0:null===(o=z.customization)||void 0===o?void 0:null===(t=o.sound)||void 0===t?void 0:t.url)&&H.current.play().catch(console.error),i})},X=()=>{console.log("\uD83D\uDC4B Hiding current alert"),_(!1),T(null),setTimeout(()=>{L()},300)};return((0,i.useEffect)(()=>{let e=l.env.NEXT_PUBLIC_BACKEND_URL||"http://localhost:3001",t=(0,a.io)("".concat(e,"/donations"),{transports:["websocket","polling"],autoConnect:!0});return t.on("connect",()=>{console.log("Connected to WebSocket server"),P(!0),t.emit("joinStreamerRoom",I.streamerId)}),t.on("disconnect",()=>{console.log("Disconnected from WebSocket server"),P(!1)}),t.on("joinedStreamerRoom",e=>{console.log("Joined streamer room:",e)}),t.on("testAlert",e=>{console.log("Received test alert:",e),U(e)}),t.on("donationAlert",e=>{console.log("Received donation alert:",e),U({alertId:e.donationId,streamerId:e.streamerId,donorName:e.donorName,amount:e.amount.toString(),message:e.message||"",timestamp:new Date(e.timestamp),isTest:!1})}),R(t),()=>{t.close()}},[I.streamerId]),(0,i.useEffect)(()=>{(async()=>{try{let e=await s(I.streamerId);C(e)}catch(e){console.error("Failed to load OBS settings:",e)}finally{k(!1)}})()},[I.streamerId]),(0,i.useEffect)(()=>{if(O&&E&&z){var e;let t=setTimeout(()=>{X()},(null===(e=z.customization)||void 0===e?void 0:e.duration)||5e3);return()=>clearTimeout(t)}},[O,E,z]),(0,i.useEffect)(()=>{var e,t,o;H.current&&(null==z?void 0:null===(e=z.customization)||void 0===e?void 0:e.sound)&&(H.current.volume=((null===(o=z.customization)||void 0===o?void 0:null===(t=o.sound)||void 0===t?void 0:t.volume)||100)/100)},[z]),(0,i.useEffect)(()=>{let e=setInterval(()=>{q(e=>{let t=Date.now(),o=e.filter(e=>t-new Date(e.timestamp).getTime()<3e4);return o.length!==e.length&&console.log("\uD83E\uDDF9 Cleaned up",e.length-o.length,"old alerts from queue"),o})},1e4);return()=>clearInterval(e)},[]),A)?(0,n.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-transparent",children:(0,n.jsx)("div",{className:"text-gray-400 text-sm",children:"Loading OBS Widget..."})}):z?O&&E?(0,n.jsxs)("div",{className:"w-full h-full bg-transparent relative overflow-hidden",children:[(0,n.jsxs)("div",{className:"absolute ".concat((()=>{var e;if(!(null===(e=z.customization)||void 0===e?void 0:e.text))return"animate-fade-in";switch(z.customization.text.animation){case"fade":return"animate-fade-in";case"slide":return"animate-slide-in";case"bounce":return"animate-bounce-in";default:return""}})()," transition-all duration-500"),style:{...(()=>{var e;switch((null===(e=z.customization)||void 0===e?void 0:e.position)||"top-right"){case"top-left":return{top:"20px",left:"20px"};case"top-right":default:return{top:"20px",right:"20px"};case"bottom-left":return{bottom:"20px",left:"20px"};case"bottom-right":return{bottom:"20px",right:"20px"};case"center":return{top:"50%",left:"50%",transform:"translate(-50%, -50%)"}}})(),backgroundColor:(null===(o=z.customization)||void 0===o?void 0:null===(t=o.text)||void 0===t?void 0:t.backgroundColor)||"#1a1a1a",color:(null===(d=z.customization)||void 0===d?void 0:null===(r=d.text)||void 0===r?void 0:r.color)||"#ffffff",fontFamily:(null===(c=z.customization)||void 0===c?void 0:null===(u=c.text)||void 0===u?void 0:u.font)||"Inter",fontSize:"".concat((null===(f=z.customization)||void 0===f?void 0:null===(m=f.text)||void 0===m?void 0:m.fontSize)||16,"px"),fontWeight:"normal",maxWidth:"300px",padding:"16px",borderRadius:"8px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",zIndex:1e3,border:"2px solid #3b82f6"},children:[(null===(v=z.customization)||void 0===v?void 0:null===(g=v.image)||void 0===g?void 0:g.url)&&(0,n.jsx)("div",{className:"mb-3",children:(null===(h=z.customization)||void 0===h?void 0:null===(p=h.image)||void 0===p?void 0:p.type)==="video"?(0,n.jsx)("video",{src:null===(w=z.customization)||void 0===w?void 0:null===(x=w.image)||void 0===x?void 0:x.url,className:"w-full h-20 object-cover rounded",muted:!0,autoPlay:!0,loop:!0,style:{maxHeight:"80px"}}):(0,n.jsx)("img",{src:null===(S=z.customization)||void 0===S?void 0:null===(b=S.image)||void 0===b?void 0:b.url,alt:"Donation alert media",className:"w-full h-20 object-cover rounded",style:{maxHeight:"80px"}})}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("span",{className:"font-semibold",children:E.donorName}),(0,n.jsxs)("span",{className:"text-lg font-bold",style:{color:"#3b82f6"},children:["$",E.amount]})]}),E.message&&(0,n.jsx)("p",{className:"text-sm opacity-90",children:E.message}),(0,n.jsx)("div",{className:"text-xs opacity-70",children:new Date(E.timestamp).toLocaleTimeString()})]}),(null===(D=z.customization)||void 0===D?void 0:null===(y=D.sound)||void 0===y?void 0:y.url)&&(0,n.jsx)("audio",{ref:H,src:null===(j=z.customization)||void 0===j?void 0:null===(N=j.sound)||void 0===N?void 0:N.url,autoPlay:!0,style:{display:"none"}})]}),!1]}):(0,n.jsx)("div",{className:"w-full h-full bg-transparent",children:!F&&(0,n.jsx)("div",{className:"absolute top-2 left-2 text-xs text-gray-400",children:"Connecting..."})}):(0,n.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-transparent",children:(0,n.jsx)("div",{className:"text-red-400 text-sm",children:"Streamer not found or widget disabled"})})}}},function(e){e.O(0,[1494,7115,141,1744],function(){return e(e.s=39160)}),_N_E=e.O()}]);